<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pacman Java Game</title>
    <style>
      body {
        margin: 0;
        background-color: #222;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        color: white;
        font-family: sans-serif;
      }
      #loading {
        position: absolute;
        font-size: 24px;
      }
    </style>
    <!-- CheerpJ Loader -->
    <script src="https://cjrtnc.leaningtech.com/3.0/cj3loader.js"></script>
  </head>
  <body>
    <div id="loading">Loading Pacman...</div>

    <script>
      // Initialize CheerpJ and run the game
      (async function () {
        try {
          console.log("Initializing CheerpJ...");

          // Dynamically determine the base path
          let basePath = window.location.pathname;
          if (!basePath.endsWith("/")) {
            basePath = basePath.substring(0, basePath.lastIndexOf("/") + 1);
          }

          console.log("Base path:", basePath);

          // Initialize CheerpJ with proper configuration
          await cheerpjInit({
            enableInputMethods: true,
            clipboardMode: "permission",
            javaProperties: [
              // Set the working directory to where the images are
              "-Duser.dir=/app" + basePath,
            ],
          });

          console.log("CheerpJ initialized successfully");
          document.getElementById("loading").textContent = "Starting game...";

          // Small delay to ensure everything is ready
          await new Promise((resolve) => setTimeout(resolve, 300));

          // Hide loading message
          document.getElementById("loading").style.display = "none";

          // Run the JAR file
          const jarPath = "/app" + basePath + "pacman_v3.jar";
          console.log("Running JAR from:", jarPath);
          await cheerpjRunJar(jarPath);

          console.log("Game started successfully");
        } catch (error) {
          console.error("Error initializing game:", error);
          document.getElementById("loading").textContent =
            "Error loading game. Check console for details. Error: " +
            error.message;
          document.getElementById("loading").style.color = "red";
        }
      })();
    </script>
  </body>
</html>
